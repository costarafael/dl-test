import{r as C,j as e,M as h,L as d,c as b,T as i,f as v,g as l,B as P,d as M}from"./index-DOaqLF5S.js";import{a as H,F as T,b as D}from"./entityHelpers-BKFEPAjO.js";const U=["Compra","Doação","Transferência","Devolução","Ajuste de inventário","Outros"],A=["Entrega ao colaborador","Transferência","Descarte por vencimento","Descarte por avaria","Perda","Outros"],B=({show:j,onClose:p,onSave:y,tiposEPI:I,estoque:f,isLoading:t=!1})=>{const[s,x]=C.useState({tipo:"entrada",responsavel:"",motivo:"",observacoes:"",itens:[{tipoEPIId:"",quantidade:1,custoUnitario:0,lote:"",observacoes:""}]}),k=D(f||[],"tipoEPIId");C.useEffect(()=>{j&&x({tipo:"entrada",responsavel:"",motivo:"",observacoes:"",itens:[{tipoEPIId:"",quantidade:1,custoUnitario:0,lote:"",observacoes:""}]})},[j]);const E=()=>s.tipo==="entrada"?U:A,c=(a,r)=>{x(n=>({...n,[a]:r}))},u=(a,r,n)=>{x(m=>({...m,itens:m.itens.map((o,S)=>S===a?{...o,[r]:r==="quantidade"||r==="custoUnitario"?Number(n):n}:o)}))},w=()=>{x(a=>({...a,itens:[...a.itens,{tipoEPIId:"",quantidade:1,custoUnitario:0,lote:"",observacoes:""}]}))},z=a=>{s.itens.length>1&&x(r=>({...r,itens:r.itens.filter((n,m)=>m!==a)}))},g=a=>{const r=k(a);return(r==null?void 0:r.quantidade)||0},N=()=>s.responsavel.trim()!==""&&s.motivo!==""&&s.itens.every(a=>a.tipoEPIId!==""&&a.quantidade>0&&(s.tipo==="entrada"||a.quantidade<=g(a.tipoEPIId))),F=async()=>{if(N())try{await y(s),p()}catch(a){console.error("Erro ao criar movimentação:",a),alert("Erro ao criar movimentação. Tente novamente.")}},q=a=>{if(s.tipo==="saida"&&a.tipoEPIId){const r=g(a.tipoEPIId);if(a.quantidade>r)return`Quantidade excede estoque disponível (${r})`}return null};return e.jsxs(h,{show:j,onClose:p,size:"6xl",children:[e.jsx(h.Header,{children:e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Nova Movimentação - ",s.tipo==="entrada"?"Entrada":"Saída"]})}),e.jsx(h.Body,{className:"overflow-y-auto max-h-[70vh]",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(d,{className:"text-gray-700 dark:text-gray-300 mb-2 block",children:["Tipo de Movimentação ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(b,{value:s.tipo,onChange:a=>c("tipo",a.target.value),sizing:"sm",className:"rounded-sm",disabled:t,children:[e.jsx("option",{value:"entrada",children:"Entrada"}),e.jsx("option",{value:"saida",children:"Saída"})]})]}),e.jsxs("div",{children:[e.jsxs(d,{className:"text-gray-700 dark:text-gray-300 mb-2 block",children:["Responsável ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(i,{value:s.responsavel,onChange:a=>c("responsavel",a.target.value),placeholder:"Nome do responsável",sizing:"sm",className:"rounded-sm",disabled:t})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs(d,{className:"text-gray-700 dark:text-gray-300 mb-2 block",children:["Motivo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(b,{value:s.motivo,onChange:a=>c("motivo",a.target.value),sizing:"sm",className:"rounded-sm",disabled:t,children:[e.jsx("option",{value:"",children:"Selecione o motivo"}),E().map(a=>e.jsx("option",{value:a,children:a},a))]})]}),s.tipo==="entrada"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-gray-700 dark:text-gray-300 mb-2 block",children:"Fornecedor"}),e.jsx(i,{value:s.fornecedor||"",onChange:a=>c("fornecedor",a.target.value),placeholder:"Nome do fornecedor",sizing:"sm",className:"rounded-sm",disabled:t})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-gray-700 dark:text-gray-300 mb-2 block",children:"Nota Fiscal"}),e.jsx(i,{value:s.notaFiscal||"",onChange:a=>c("notaFiscal",a.target.value),placeholder:"Número da NF",sizing:"sm",className:"rounded-sm",disabled:t})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-gray-700 dark:text-gray-300 mb-2 block",children:"Destinatário"}),e.jsx(i,{value:s.destinatario||"",onChange:a=>c("destinatario",a.target.value),placeholder:"Nome do destinatário",sizing:"sm",className:"rounded-sm",disabled:t})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-gray-700 dark:text-gray-300 mb-2 block",children:"Solicitante"}),e.jsx(i,{value:s.solicitante||"",onChange:a=>c("solicitante",a.target.value),placeholder:"Nome do solicitante",sizing:"sm",className:"rounded-sm",disabled:t})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs(d,{className:"text-gray-700 dark:text-gray-300",children:["Itens da Movimentação ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(v,{onClick:w,color:"primary",size:"xs",className:"rounded-sm",disabled:t,children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"Adicionar Item"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(l,{children:[e.jsxs(l.Head,{children:[e.jsx(l.HeadCell,{children:"Equipamento"}),e.jsx(l.HeadCell,{children:"Quantidade"}),e.jsx(l.HeadCell,{children:"Estoque Atual"}),s.tipo==="entrada"&&e.jsxs(e.Fragment,{children:[e.jsx(l.HeadCell,{children:"Custo Unit."}),e.jsx(l.HeadCell,{children:"Lote"})]}),e.jsx(l.HeadCell,{children:"Observações"}),e.jsx(l.HeadCell,{children:"Ações"})]}),e.jsx(l.Body,{children:s.itens.map((a,r)=>{const n=g(a.tipoEPIId),m=q(a);return e.jsxs(l.Row,{children:[e.jsx(l.Cell,{className:"min-w-[200px]",children:e.jsxs(b,{value:a.tipoEPIId,onChange:o=>u(r,"tipoEPIId",o.target.value),sizing:"sm",className:"rounded-sm",disabled:t,children:[e.jsx("option",{value:"",children:"Selecione o equipamento"}),(I||[]).map(o=>e.jsxs("option",{value:o.id,children:[o.nomeEquipamento," - CA ",o.numeroCA]},o.id))]})}),e.jsx(l.Cell,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{type:"number",min:"1",max:s.tipo==="saida"?n:void 0,value:a.quantidade,onChange:o=>u(r,"quantidade",o.target.value),sizing:"sm",className:"rounded-sm w-20",disabled:t}),m&&e.jsx("p",{className:"text-xs text-red-500",children:m})]})}),e.jsx(l.Cell,{children:a.tipoEPIId&&e.jsxs(P,{color:n>0?"green":"red",className:"w-fit",children:[n," un."]})}),s.tipo==="entrada"&&e.jsxs(e.Fragment,{children:[e.jsx(l.Cell,{children:e.jsx(i,{type:"number",step:"0.01",min:"0",value:a.custoUnitario||"",onChange:o=>u(r,"custoUnitario",o.target.value),placeholder:"0,00",sizing:"sm",className:"rounded-sm w-24",disabled:t})}),e.jsx(l.Cell,{children:e.jsx(i,{value:a.lote||"",onChange:o=>u(r,"lote",o.target.value),placeholder:"Lote/Série",sizing:"sm",className:"rounded-sm w-32",disabled:t})})]}),e.jsx(l.Cell,{className:"min-w-[150px]",children:e.jsx(i,{value:a.observacoes||"",onChange:o=>u(r,"observacoes",o.target.value),placeholder:"Observações...",sizing:"sm",className:"rounded-sm",disabled:t})}),e.jsx(l.Cell,{children:s.itens.length>1&&e.jsx(v,{onClick:()=>z(r),color:"failure",size:"xs",className:"rounded-sm",disabled:t,children:e.jsx(T,{className:"h-4 w-4"})})})]},r)})})]})})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-gray-700 dark:text-gray-300 mb-2 block",children:"Observações Gerais"}),e.jsx(M,{value:s.observacoes||"",onChange:a=>c("observacoes",a.target.value),placeholder:"Observações sobre a movimentação...",rows:3,className:"rounded-sm",disabled:t})]})]})}),e.jsx(h.Footer,{children:e.jsxs("div",{className:"flex justify-end space-x-3 w-full",children:[e.jsx(v,{onClick:p,color:"gray",sizing:"sm",className:"rounded-sm",disabled:t,children:"Cancelar"}),e.jsx(v,{onClick:F,color:"primary",sizing:"sm",className:"rounded-sm",disabled:!N()||t,children:t?"Processando...":`Registrar ${s.tipo==="entrada"?"Entrada":"Saída"}`})]})})]})};export{B as N};
//# sourceMappingURL=NewMovementModal-DcOUhh5s.js.map
