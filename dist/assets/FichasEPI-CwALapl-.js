import{r as c,j as e,B as $,u as U,f as m,D as I,L as P,T as W,c as K,g as r,P as Q,M as X}from"./index-DOaqLF5S.js";import{F as ee,S as z,a as se}from"./SearchableDropdown-BGqvdnH0.js";import{b as ae,c as re,u as B,f as te,d as le,g as oe}from"./format-G53zHD2b.js";import{F as ie}from"./ArrowDownTrayIcon-BeJoba6h.js";import{F as ne}from"./DocumentDuplicateIcon-42Le6T4F.js";import{F as ce}from"./EyeIcon-CDoVhD-a.js";import"./MagnifyingGlassIcon-B7c_-jcv.js";function de({title:i,titleId:t,...g},x){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":t},g),i?c.createElement("title",{id:t},i):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))}const me=c.forwardRef(de),xe=({status:i,variant:t="user"})=>{const g=(f,n)=>{const o={user:{ativo:{color:"success",text:"Ativo"},inativo:{color:"gray",text:"Inativo"},afastado:{color:"warning",text:"Afastado"},desligado:{color:"failure",text:"Desligado"}},ficha:{ativo:{color:"success",text:"Ativo"},suspenso:{color:"warning",text:"Suspenso"},arquivado:{color:"gray",text:"Arquivado"},vencido:{color:"failure",text:"Vencido"}},estoque:{normal:{color:"success",text:"Normal"},baixo:{color:"warning",text:"Baixo"},"em falta":{color:"failure",text:"Em falta"},falta:{color:"failure",text:"Em falta"}}}[n];return o?o[f]||{color:"gray",text:f}:{color:"gray",text:f}},{color:x,text:S}=g(i,t);return e.jsx($,{color:x,size:"sm",className:"w-fit",children:S})},he=async i=>{try{const t={...i,id:`hist_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,data:new Date().toISOString()};return await ae.create(t),t}catch(t){console.error("Erro ao registrar evento no histórico:",t)}},ue=(i,t)=>({fichaEPIId:i,tipo:"ficha_criada",responsavel:"Sistema EPI",descricao:`Ficha de EPI criada para o colaborador ${t}`}),be=()=>{const i=U(),{fichas:t,loading:g,error:x,createFicha:S,loadFichas:f}=re(),{data:n,loading:N}=B(le.getAll),{data:o}=B(oe.getAll),[A,y]=c.useState(!1),[b,D]=c.useState(""),[F,T]=c.useState("todos"),[E,O]=c.useState("todas"),[h,C]=c.useState(""),[p,j]=c.useState(""),M=s=>o==null?void 0:o.find(a=>a.id===s),q=s=>n==null?void 0:n.find(a=>a.id===s),H=s=>(o==null?void 0:o.filter(a=>a.empresaId===s&&a.status==="ativo"&&!a.temFichaAtiva))||[],V=s=>{if(!s)return"";const a=typeof s=="string"?new Date(s):s;return te(a,"dd/MM/yyyy")},k=t.filter(s=>{const a=F==="todos"||s.status===F,d=E==="todas"||s.empresaId===E,l=M(s.colaboradorId),u=!b||(l==null?void 0:l.nome.toLowerCase().includes(b.toLowerCase()))||(l==null?void 0:l.cargo.toLowerCase().includes(b.toLowerCase()));return a&&d&&u}),L=s=>{i(`/fichas/${s.id}`)},_=s=>{var a;return((a=s.itens)==null?void 0:a.filter(d=>d.status==="entregue").length)||0},[v,J]=c.useState(1),w=10,Y=Math.ceil(k.length/w),R=k.slice((v-1)*w,v*w),Z=s=>{J(s),window.scrollTo(0,0)};return g||N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Carregando fichas..."})]})}):x?e.jsx("div",{className:"max-w-4xl mx-auto mt-8 p-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Erro ao carregar fichas"}),e.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[e.jsx("p",{children:x}),e.jsx("p",{className:"mt-2",children:"Verifique se o JSON Server está rodando na porta 3001."})]}),e.jsx("div",{className:"mt-4",children:e.jsx(m,{onClick:f,color:"failure",size:"sm",className:"rounded-sm",children:"Tentar novamente"})})]})]})})}):e.jsxs("div",{className:"bg-white dark:bg-gray-900",children:[e.jsx("div",{className:"mx-auto max-w-full",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 relative shadow-md sm:rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between space-y-3 md:space-y-0 md:space-x-4 p-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Fichas de EPI"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Gerencie fichas de equipamentos de proteção individual"})]}),e.jsxs("div",{className:"w-full md:w-auto flex flex-col md:flex-row space-y-2 md:space-y-0 items-stretch md:items-center justify-end md:space-x-3 flex-shrink-0",children:[e.jsxs(m,{onClick:()=>y(!0),color:"primary",sizing:"xs",className:"rounded-sm",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Nova ficha"]}),e.jsxs(I,{label:"",dismissOnClick:!1,renderTrigger:()=>e.jsx(m,{color:"light",sizing:"xs",className:"rounded-sm",children:e.jsx(ee,{className:"w-4 h-4"})}),children:[e.jsx(I.Item,{icon:ie,children:"Exportar"}),e.jsx(I.Item,{icon:ne,children:"Duplicar selecionados"})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between space-y-3 md:space-y-0 md:space-x-4 p-4 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(P,{htmlFor:"table-search",className:"sr-only",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})}),e.jsx(W,{id:"table-search",placeholder:"Buscar fichas...",value:b,onChange:s=>D(s.target.value),sizing:"sm",className:"pl-10 rounded-sm"})]})]}),e.jsxs("div",{className:"w-full md:w-auto flex flex-col md:flex-row space-y-2 md:space-y-0 items-stretch md:items-center justify-end md:space-x-3 flex-shrink-0",children:[e.jsxs(K,{value:F,onChange:s=>T(s.target.value),sizing:"sm",className:"rounded-sm",children:[e.jsx("option",{value:"todos",children:"Todos os status"}),e.jsx("option",{value:"ativo",children:"Ativo"}),e.jsx("option",{value:"suspenso",children:"Suspenso"}),e.jsx("option",{value:"arquivado",children:"Arquivado"})]}),e.jsx(z,{options:(n==null?void 0:n.map(s=>({value:s.id,label:s.nome})))||[],value:E,onChange:O,placeholder:"Selecionar empresa...",searchPlaceholder:"Buscar empresas...",allOptionsLabel:"Todas as empresas",sizing:"sm",disabled:N}),e.jsxs(m,{color:"light",sizing:"xs",className:"rounded-sm",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Filtros"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(r,{hoverable:!0,className:"min-w-full",children:[e.jsxs(r.Head,{children:[e.jsx(r.HeadCell,{children:"Colaborador"}),e.jsx(r.HeadCell,{children:"Empresa"}),e.jsx(r.HeadCell,{children:"EPIs Ativos"}),e.jsx(r.HeadCell,{children:"Status"}),e.jsx(r.HeadCell,{children:"Última Atualização"}),e.jsx(r.HeadCell,{className:"w-20",children:e.jsx("span",{className:"sr-only",children:"Ações"})})]}),e.jsx(r.Body,{className:"divide-y",children:R.length>0?R.map(s=>{var l;const a=M(s.colaboradorId),d=q(s.empresaId);return!a||!d?null:e.jsxs(r.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer",onClick:()=>L(s),children:[e.jsxs(r.Cell,{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:a.nome}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.cargo})]}),e.jsxs(r.Cell,{children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:d.nome}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:d.cnpj})]}),e.jsx(r.Cell,{children:e.jsx($,{color:"primary",size:"sm",className:"w-fit",children:_(s)})}),e.jsx(r.Cell,{children:e.jsx(xe,{status:s.status})}),e.jsxs(r.Cell,{children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:V(s.dataEmissao)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[((l=s.itens)==null?void 0:l.length)||0," itens"]})]}),e.jsx(r.Cell,{children:e.jsx("div",{className:"flex justify-end",children:e.jsx(m,{sizing:"xs",color:"primary",onClick:u=>{u.stopPropagation(),L(s)},title:"Visualizar",className:"rounded-sm",children:e.jsx(ce,{className:"w-4 h-4"})})})})]},s.id)}):e.jsx(r.Row,{children:e.jsx(r.Cell,{colSpan:7,className:"text-center py-8",children:e.jsx("div",{className:"flex flex-col items-center justify-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Nenhuma ficha encontrada"})})})})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-3 md:space-y-0 p-4",children:[e.jsxs("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:["Mostrando ",e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[(v-1)*w+1,"-",Math.min(v*w,k.length)]})," de ",e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:k.length})]}),e.jsx(Q,{currentPage:v,totalPages:Y,onPageChange:Z,showIcons:!0,className:"mb-4"})]})]})}),e.jsx(X,{show:A,onClose:()=>{y(!1),C(""),j("")},size:"xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:"Nova Ficha de EPI"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(P,{htmlFor:"empresa",className:"text-gray-700 dark:text-gray-300 mb-2 block",children:["Empresa Contratada ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{options:(n==null?void 0:n.filter(s=>s.tipo==="contratada").map(s=>({value:s.id,label:s.nome})))||[],value:h,onChange:s=>{C(s),j("")},placeholder:"Selecione uma empresa...",searchPlaceholder:"Buscar empresas...",allOptionsLabel:"Selecione",sizing:"sm",disabled:N})]}),h&&e.jsxs("div",{children:[e.jsxs(P,{htmlFor:"colaborador",className:"text-gray-700 dark:text-gray-300 mb-2 block",children:["Colaborador ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{options:H(h).map(s=>({value:s.id,label:`${s.nome} - CPF: ${s.cpf}`,subtitle:s.cargo})),value:p,onChange:j,placeholder:"Selecione um colaborador...",searchPlaceholder:"Buscar por nome ou CPF...",sizing:"sm",showSubtitle:!0})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(m,{onClick:()=>{y(!1),C(""),j("")},color:"gray",sizing:"xs",className:"rounded-sm",children:"Cancelar"}),e.jsx(m,{onClick:async()=>{if(h&&p)try{const s=new Date,a=new Date(s);a.setFullYear(a.getFullYear()+1);const d={id:`nova_${Date.now()}`,colaboradorId:p,empresaId:h,dataEmissao:s.toISOString(),dataValidade:a.toISOString(),status:"ativo",itens:[]},l=await S(d),u=o==null?void 0:o.find(G=>G.id===p);u&&await he(ue(l.id,u.nome)),console.log("Nova ficha criada:",l),y(!1),C(""),j(""),i(`/fichas/${l.id}`)}catch(s){console.error("Erro ao criar ficha:",s),alert("Erro ao criar ficha. Verifique se o JSON Server está rodando.")}},color:"primary",sizing:"xs",className:"rounded-sm",disabled:!h||!p,children:"Criar Ficha"})]})]})})]})};export{be as default};
//# sourceMappingURL=FichasEPI-CwALapl-.js.map
